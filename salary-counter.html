<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<title>Счетчик зарплаты</title>
	</head>
	<style>
		*::selection {
			background-color: #383838;
		}

		body {
			background-color: #424242;
			font-family: Arial, sans-serif;
			margin: 0;
		}

		main {
			margin: 50px auto 0;
			display: table;
			padding: 20px 50px;
			background-color: #313131;
			border-radius: 10px;
			box-shadow: 0 4px 6px #0000004b;
		}

		p {
			font-size: 35px;
			color: #a5a5a5;
			text-align: center;
			margin: 20px 0;
		}

		#info,
		#lunch-info {
			display: block;
			font-size: 24px;
		}

		#salary {
			font-weight: 600;
		}

		.salary-during-work {
			color: #4caf50;
		}

		.salary-lunch-break {
			color: #ff9800;
		}

		.salary-after-work {
			color: #2196f3;
		}

		.salary-before-work {
			color: #757575;
		}
	</style>
	<body>
		<main>
			<p id="clock"></p>

			<div>
				<p id="info"></p>

				<p id="salary"></p>

				<p id="lunch-info"></p>
			</div>
		</main>

		<script>
			/* === НАСТРОЙКИ === */
			// 1. Рабочее время
			var WORK_START_HOUR = 8; // Начало рабочего дня (часы)
			var WORK_START_MINUTE = 15; // Начало рабочего дня (минуты)
			var WORK_END_HOUR = 17; // Конец рабочего дня (часы)
			var WORK_END_MINUTE = 15; // Конец рабочего дня (минуты)

			// 2. Обеденный перерыв
			var HAS_LUNCH_BREAK = true; // Рабочий день с обедом - true, без обеда - false
			var IS_LUNCH_PAID = false; // Обед оплачивается - true, не оплавичается - false (игнорируется, если рабочий день без обеда)
			var LUNCH_START_HOUR = 12; // Начало обеда (часы)
			var LUNCH_START_MINUTE = 15; // Начало обеда (минуты)
			var LUNCH_END_HOUR = 13; // Конец обеда (часы)
			var LUNCH_END_MINUTE = 15; // Конец обеда (минуты)

			// 3. Ставки
			var WEEKDAY_SALARY_PER_MINUTE = 2.7; // Зарплата в миннуту в будни (в рублях)
			var WEEKEND_SALARY_PER_MINUTE = 3.3; // Зарплата в миннуту в выходные (в рублях)
			/* === КОНЕЦ НАСТРОЕК === */

			LUNCH_END_HOUR = HAS_LUNCH_BREAK ? LUNCH_END_HOUR : LUNCH_START_HOUR;
			LUNCH_END_MINUTE = HAS_LUNCH_BREAK
				? LUNCH_END_MINUTE
				: LUNCH_START_MINUTE;

			var LUNCH_DURATION_IN_MINUTES =
				LUNCH_END_HOUR * 60 +
				LUNCH_END_MINUTE -
				(LUNCH_START_HOUR * 60 + LUNCH_START_MINUTE);

			var SHOULD_SHOW_LUNCH_BREAK =
				HAS_LUNCH_BREAK && LUNCH_DURATION_IN_MINUTES > 0;

			var MESSAGES = {
				DURING: 'Сегодняшний заработок (',
				AFTER: 'Рабочий день закончен. Заработано:',
				BEFORE: 'Рабочий день еще не начался.',
				LUNCH: 'Обеденный перерыв. Заработано:',
				LUNCH_INFO: 'Обед заканчивается через:',
				WEEKDAY: 'будний',
				WEEKEND: 'выходной',
				CURRENCY: '₽',
			};

			function formatCurrency(amount) {
				var parts = amount.toFixed(2).split('.');
				var integerPart = parts[0];
				var result = '';

				for (var i = integerPart.length; i > 0; i -= 3) {
					var chunk = integerPart.substring(Math.max(0, i - 3), i);
					result = chunk + (result ? ' ' : '') + result;
				}

				return result + '.' + parts[1] + ' ' + MESSAGES.CURRENCY;
			}

			function padZero(number) {
				return number < 10 ? '0' + number : number.toString();
			}

			function calculateSalary(
				currentTimeInMinutes,
				workStartInMinutes,
				todaysSalaryPerMinute,
				lunchDurationInMinutes
			) {
				var workedMinutes = currentTimeInMinutes - workStartInMinutes;

				if (lunchDurationInMinutes) {
					workedMinutes -= lunchDurationInMinutes;
				}

				var salaryEarned = workedMinutes * todaysSalaryPerMinute;

				return salaryEarned;
			}

			function updateElement(
				infoMessage,
				salaryMessage,
				salaryClass,
				lunchInfoMessage
			) {
				var infoElement = document.getElementById('info');
				var salaryElement = document.getElementById('salary');
				var lunchInfo = document.getElementById('lunch-info');

				infoElement.textContent = infoMessage;
				salaryElement.textContent = formatCurrency(salaryMessage);
				salaryElement.className = salaryClass;
				lunchInfo.textContent = lunchInfoMessage;
			}

			function getLunchRemainingText(
				hours,
				minutes,
				seconds,
				lunchStart,
				lunchDuration
			) {
				var currentTimeInSeconds = hours * 3600 + minutes * 60 + seconds;
				var lunchStartInSeconds = lunchStart * 60;
				var lunchDurationInSeconds = lunchDuration * 60;

				var secondsPassed = currentTimeInSeconds - lunchStartInSeconds;
				var secondsRemaining = lunchDurationInSeconds - secondsPassed;

				var remainingHours = Math.floor(secondsRemaining / 3600);
				var remainingMinutes = Math.floor((secondsRemaining % 3600) / 60);
				var remainingSeconds = secondsRemaining % 60;

				return (
					MESSAGES.LUNCH_INFO +
					' ' +
					padZero(remainingHours) +
					':' +
					padZero(remainingMinutes) +
					':' +
					padZero(remainingSeconds)
				);
			}

			function startSalaryCounter() {
				var clockElement = document.getElementById('clock');

				var now = new Date();
				var hours = now.getHours();
				var minutes = now.getMinutes();
				var seconds = now.getSeconds();
				var day = now.getDay();

				var totalMinutesNow = hours * 60 + minutes + seconds / 60;

				var workStartInMinutes = WORK_START_HOUR * 60 + WORK_START_MINUTE;
				var workEndInMinutes = WORK_END_HOUR * 60 + WORK_END_MINUTE;

				var lunchStartInMinutes = LUNCH_START_HOUR * 60 + LUNCH_START_MINUTE;
				var lunchEndInMinutes = LUNCH_END_HOUR * 60 + LUNCH_END_MINUTE;

				var isWeekendDay = day === 6 || day === 0;
				var todaysSalaryPerMinute = isWeekendDay
					? WEEKEND_SALARY_PER_MINUTE
					: WEEKDAY_SALARY_PER_MINUTE;

				clockElement.textContent =
					padZero(hours) + ':' + padZero(minutes) + ':' + padZero(seconds);

				if (
					// До обеда
					totalMinutesNow >= workStartInMinutes &&
					totalMinutesNow < lunchStartInMinutes
				) {
					var salaryEarned = calculateSalary(
						totalMinutesNow,
						workStartInMinutes,
						todaysSalaryPerMinute
					);

					updateElement(
						MESSAGES.DURING +
							(isWeekendDay ? MESSAGES.WEEKEND : MESSAGES.WEEKDAY) +
							'):',
						salaryEarned,
						'salary-during-work',
						''
					);
				} else if (
					// Обед
					SHOULD_SHOW_LUNCH_BREAK &&
					totalMinutesNow >= lunchStartInMinutes &&
					totalMinutesNow < lunchEndInMinutes
				) {
					var minutesForCalculation = IS_LUNCH_PAID
						? totalMinutesNow
						: lunchStartInMinutes;

					var salaryEarned = calculateSalary(
						minutesForCalculation,
						workStartInMinutes,
						todaysSalaryPerMinute
					);

					var lunchRemainingText = getLunchRemainingText(
						hours,
						minutes,
						seconds,
						lunchStartInMinutes,
						LUNCH_DURATION_IN_MINUTES
					);

					updateElement(
						MESSAGES.LUNCH,
						salaryEarned,
						'salary-lunch-break',
						lunchRemainingText
					);
				} else if (
					// После обеда
					totalMinutesNow >= lunchEndInMinutes &&
					totalMinutesNow < workEndInMinutes
				) {
					var salaryEarned = calculateSalary(
						totalMinutesNow,
						workStartInMinutes,
						todaysSalaryPerMinute,
						IS_LUNCH_PAID ? 0 : LUNCH_DURATION_IN_MINUTES
					);

					updateElement(
						MESSAGES.DURING +
							(isWeekendDay ? MESSAGES.WEEKEND : MESSAGES.WEEKDAY) +
							'):',
						salaryEarned,
						'salary-during-work',
						''
					);
				} else if (
					// После рабочего дня
					totalMinutesNow >= workEndInMinutes
				) {
					var totalSalary = calculateSalary(
						workEndInMinutes,
						workStartInMinutes,
						todaysSalaryPerMinute
					);

					updateElement(MESSAGES.AFTER, totalSalary, 'salary-after-work', '');
				} else {
					// До начала работы
					updateElement(MESSAGES.BEFORE, 0, 'salary-before-work', '');
				}

				var millisecondsToNextSecond = 1000 - now.getMilliseconds();
				setTimeout(startSalaryCounter, millisecondsToNextSecond);
			}

			startSalaryCounter();
		</script>
	</body>
</html>
